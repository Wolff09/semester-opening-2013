@import "compass/css3/border-radius";
@import "compass/css3/box-shadow";
@import "compass/css3/hyphenation";
@import "compass/css3/opacity";
@import "compass/css3/text-shadow";
@import "compass/css3/images";

// TODO: do we need the following?
@import "compass/css3/transition";
@import "compass/css3/transform";

& {
	width: $box-width;
	padding: $box-padding-top $box-padding-left-right $box-padding-bottom $box-padding-left-right;
	position: relative;
	z-index: 10;
	@include border-radius($box-border-radius);
	@include single-box-shadow($box-shadow-color, $box-shadow-width, $box-shadow-width, $box-shadow-blur);
	@include opacity($box-opacity);
	background: $box-background-color;
	@if $box-background-use-gradient {
		@include background-image(linear-gradient($box-background-color-start, $box-background-color-end));
	}
	border: $box-border-width solid $box-border-color;
	color: $text-color;
	font-size: 90%;
	font-family: $text-font;
	font-size: $text-size;
	line-height: 1.5em;

	#{headings(all)} {
		position: relative;
		width: $box-width + 2*$head-overflow-size;
		color: $head-color;
		padding: $head-padding-top-bottom 0;
		margin-left: -$head-overflow-size;
		margin-right: -$head-overflow-size;
		margin-top: 0;
		margin-bottom: $head-margin-bottom;
		left: 0;
		z-index: 11;

		@include single-box-shadow($head-background-shadow-color, $head-background-shadow-width, $head-background-shadow-width, $head-background-shadow-blur);
		background: $head-background-color;
		@if $head-background-use-gradient {
			@include background-image(linear-gradient($head-background-color-start, $head-background-color-end));
		}

		font-family: $head-font;
		font-size: $head-size;
		line-height: $head-line-height;
		font-weight: $head-font-weight;
		text-align: center;
		@include text-shadow($head-text-shadows...);

		@mixin badge-effect-triangle($anchor) {
			$badge-border-width: $head-overflow-size - $box-border-width - $box-padding-left-right;
			content: "\00a0";
			display: block; /* reduce the damage in FF3.0 */
			position: absolute;
			bottom: -2*$badge-border-width; /* value = - border-top-width - border-bottom-width */
			#{$anchor}: 0;
			width: 0;
			height: 0;
			border-style: solid;
			border-width: $badge-border-width;
			@if $head-background-use-gradient {
				border-color: darken($head-background-color-end, $head-background-badge-fade) transparent transparent;
			}
			@else {
				border-color: darken($head-background-color, $head-background-badge-fade) transparent transparent;
			}
			z-index: 9;
		}

		&:before {
			@include badge-effect-triangle("left");
			border-right-width: 0;
		}

		&:after {
			@include badge-effect-triangle("right");
			border-left-width: 0;
		}

		span {
			display: block;
			padding: 0 $head-padding-left-right;
		}
	}

	p {
		margin: 4px;
		margin-bottom: 1em;
		@include word-break(break-all);

		strong {
			display: block;
		}
	}

	.naviLinks {
		text-align: center;
		margin-top: 1.5em;

		a.scrollLink {
			border: 1px solid $link-border-color;
			background-color: $link-background-color;
			padding: 3px 6px;
			text-decoration: none;
			color: $link-color;
			font-size: $text-size - 1;
			margin: 4px;
			@include border-radius(4px);

			&:hover {
				background-color: $link-background-color-hover;
				color: $link-color-hover;
				@include single-transition();
			}
		}
	}

	/* ######################################################################################
	   ##################### Your are entering the experimental stage ! #####################
	   ###################################################################################### */

	.navi {
		display: block;
		li { display: inline-block; }

		a {
			font-size: $text-size;
			display: block;
			text-decoration: none;
			// font-smoothing: antialiased;
			// text-transform: uppercase;
			overflow: visible;
			padding: 3px 3px;
		}

		a:hover {
		}

		/* animation domination */
		.three-d {
			-webkit-perspective: 200px;
			-webkit-transition: all .07s linear;
			position: relative;
			cursor: pointer;
		}
		/* complete the animation! */
		.three-d:hover .three-d-box, 
		.three-d:focus .three-d-box {
			-webkit-transform: translateZ(-25px) rotateX(90deg);
		}

		.three-d-box {
			-webkit-transition: all .3s ease-out;
			-webkit-transform: translatez(-25px);
			-webkit-transform-style: preserve-3d;
			pointer-events: none;
			position: absolute;
			top: 0;
			left: 0;
			display: block;
			width: 100%;
			height: 100%;
		}

		/* 
			put the "front" and "back" elements into place with CSS transforms, 
			specifically translation and translatez
		*/
		.front {
			-webkit-transform: rotatex(0deg) translatez(15px);
		}

		.back {
			-webkit-transform: rotatex(-90deg) translatez(15px);
		}

		.front, .back {
			color: inherit;
			display: block;
			width: 100%;
			height: 100%;
			position: absolute;
			top: 0;
			left: 0;
			padding: 3px 3px;
			pointer-events: none;
			box-sizing: border-box;
		}

		.front {
			color: $link-color;
			background-color: $link-background-color;
		}
		.back {
			color: darken($head-color, 20%);
			background-color: $head-background-color;
		}
	}
}